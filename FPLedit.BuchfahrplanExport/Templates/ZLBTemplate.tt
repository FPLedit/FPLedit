<#@ template language="C#" #>
<#@ import namespace="FPLedit.Shared" #>
<#@ import namespace="FPLedit.BuchfahrplanExport.Model" #>

<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Buchfahrplan generiert von FPLedit</title>
		<style>
		table:not(.tfz-table) {
			border-collapse: collapse;
			table-layout:fixed;
			width:454pt;
			margin-left:auto;
			margin-right:auto;
			margin-bottom:65px;
		}
		body {
			font-family:<#= font #>, serif;
		}
		table:not(.first) {
			page-break-before:always;
		}
		td {
			padding-top:1px;
			padding-right:1px;
			padding-left:1px;
			color:black;
			white-space:nowrap;
			font-size:11.0pt;
		}
		.tfz {
			font-weight:400;
			vertical-align:bottom;
			padding-bottom:30px;
		}
		.tfz-table {
			width: 100%;
		}
		.tfz-table td {
			width: 33%;
		}
		.tfz-table td:nth-child(2) {
			text-align: center;
		}
		.tfz-table td:nth-child(3) {
			text-align: right;
		}
		.trainname {
			height:19.5pt;
			font-size:15.0pt;
			font-weight:bold;
			text-align:center;
			vertical-align:middle;
		}
		.linename {
			font-size:12.0pt;
			font-weight:bold;
			text-align:center;
			vertical-align:middle;
		}
		.spaltennummer {
			font-weight:400;
			text-align:center;
			vertical-align:top;
			border:1.5pt solid black;
			border-bottom:.5pt solid black;
			border-top:2.5pt solid black;
		}
		.spaltenkopf {
			height: 120px;
			font-weight:400;
			text-align:center;
			vertical-align:top;
			border:1.5pt solid black;
			border-top:.5pt solid black;
		}
		.klein {
			font-size:0.7em;
			white-space: normal;
		}
		.zug {
			height: 19px;
			font-weight:400;
			text-align:center;
			vertical-align:top;
			border-right:1.5pt solid black;
			border-left:1.5pt solid black;
		}
		.trapez-tt {
			border: 1px solid black;
			padding: 2px;
		}
		td.first {
			border-left:none;
		}
		td.last {
			border-right:none;
		}
		@media print {
			@page {
				margin: 0;
			}
		}

		.stat {
			border-right:none;
			padding-left: 20px;
		}
		.welle {
			border-left:none;
			background-repeat: repeat-y;
			background-position: right 2px top;
		}
		.welle1 {
			/*background-image: url(drawing.svg);*/
			background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iNG1tIiB3aWR0aD0iMm1tIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA3LjA4NjYxNDIgMTQuMTczMjI4Ij4NCjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgLTEwMzguMikiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxcHgiIGZpbGw9Im5vbmUiPg0KPHBhdGggZD0ibS0wLjAzMTU2NyAxMDQ1LjMgNy4xMDI2IDcuMDcxMSIvPg0KPHBhdGggZD0ibTcuMDU1MyAxMDM4LjItNy4xMDI2IDcuMDcxMSIvPg0KPC9nPg0KPC9zdmc+DQo=);
			background-size: 5px 9.5px;
		}
		.welle2 {
			/*background-image: url(drawing2.svg);*/
			background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iNG1tIiB3aWR0aD0iNG1tIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxNC4xNzMyMjkgMTQuMTczMjI4Ij4NCjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgLTEwMzguMikiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxcHgiIGZpbGw9Im5vbmUiPg0KPHBhdGggZD0ibS0wLjAzMTU2NyAxMDQ1LjMgNy4xMDI2IDcuMDcxMSIvPg0KPHBhdGggZD0ibTcuMDU1MyAxMDM4LjItNy4xMDI2IDcuMDcxMSIvPg0KPHBhdGggZD0ibTcuMDU2NCAxMDQ1LjMgNy4xMDI2IDcuMDcxMSIvPg0KPHBhdGggZD0ibTE0LjE0MyAxMDM4LjItNy4xMDI2IDcuMDcxMSIvPg0KPC9nPg0KPC9zdmc+DQo=);
			background-size: 10px 9.5px;
		}
		.welle3 {
			/*background-image: url(drawing3.svg);*/
			background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iNG1tIiB3aWR0aD0iNm1tIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyMS4yNTk4NDMgMTQuMTczMjI4Ij4NCjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgLTEwMzguMikiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxcHgiIGZpbGw9Im5vbmUiPg0KPHBhdGggZD0ibS0wLjAzMTU2NyAxMDQ1LjMgNy4xMDI2IDcuMDcxMSIvPg0KPHBhdGggZD0ibTcuMDU1MyAxMDM4LjItNy4xMDI2IDcuMDcxMSIvPg0KPHBhdGggZD0ibTcuMDU2NCAxMDQ1LjMgNy4xMDI2IDcuMDcxMSIvPg0KPHBhdGggZD0ibTE0LjE0MyAxMDM4LjItNy4xMDI2IDcuMDcxMSIvPg0KPHBhdGggZD0ibTE0LjEzNCAxMDQ1LjMgNy4xMDI2IDcuMDcxMSIvPg0KPHBhdGggZD0ibTIxLjIyMSAxMDM4LjItNy4xMDI2IDcuMDcxMSIvPg0KPC9nPg0KPC9zdmc+);
			background-size: 15px 9.5px;
		}
		</style>
		<style id="add-css">
			<#= additionalCss #>
		</style>
	</head>
	<body>
		<div>
			<#
			bool first = true; // No pagebreak before first train
			foreach (Train tra in tt.Trains) { #>
			<table id="<#= helper.HtmlName(tra.TName, "train-") #>" class="<#= first ? "first" : "" #>">
				<# first = false; #>
				<col style="width:50px;">
				<col style="width:50px;">
				<col style="width:180px;">
				<col style="width:20px;"><!-- Welle -->
				<col style="width:62px;">
				<col style="width:50px;">
				<col style="width:50px;">
				<tr>
					<td colspan="10" class="trainname"><#= tra.TName #></td>
				</tr>
				<tr>
					<td colspan="10" class="linename"><#= tt.GetLineName(tra.Direction) #></td>
				</tr>
				<tr>
					<td class="tfz" colspan="10">
					<table class="tfz-table"><tr>
					<td><#= helper.OptAttr("Zlok", tra.Locomotive) #></td>
					<td><#= helper.OptAttr("Last", tra.Last) #></td>
					<td><#= helper.OptAttr("Mbr", tra.Mbr) #></td>
					</tr></table>
					</td>
				</tr>
				<tr>
					<td class="spaltennummer first">1</td>
					<td class="spaltennummer">2</td>
					<td class="spaltennummer" colspan="2">3</td>
					<td class="spaltennummer">4</td>
					<td class="spaltennummer">5</td>
					<td class="spaltennummer">6</td>
					<td class="spaltennummer">7</td>
					<td class="spaltennummer">8</td>
					<td class="spaltennummer last">9</td>
				</tr>
				<tr>
					<td class="spaltenkopf klein first">Lage<br>der<br>Betriebs-<br>stelle<br><br>km</td>
					<td class="spaltenkopf klein">Höchst-<br>ge-<br>schwin-<br>digkeit<br><br>km/h</td>
					<td class="spaltenkopf" colspan="2">Betriebsstellen,<br>ständige Langsam-<br>fahrstellen,<br>verkürzter<br>Vorsignalabstand</td>
					<td class="spaltenkopf klein">An der<br>Trapeztafel<br>hält Zug</td>
					<td class="spaltenkopf">An-<br>kunft</td>
					<td class="spaltenkopf">Ab-<br>fahrt</td>
					<td class="spaltenkopf klein">Kreu-<br>zung<br>mit Zug</td>
					<td class="spaltenkopf klein">über-<br>holt<br>&mdash;<br>wird<br>über-<br>holt<br>durch<br>Zug</td>
					<td class="spaltenkopf klein last">Zuglauf-<br>meldung<br>durch</td>
				</tr>
				<#
				int rs_counter = 0;
				foreach (var entity in helper.GetStations(tra.Direction)) { #>
				<tr class="<#= helper.HtmlName(entity.SName, "station-") #>">
					<#
					if (entity.GetType() == typeof(Station)) {
						Station s = (Station)entity; #>
					<td class="zug first"><#= s.Kilometre.ToString("0.0") #></td>
					<td class="zug"><#= s.GetAttribute("fpl-vmax", "") #></td>
					<td class="zug stat"><#= s.SName #></td>
					<#= GetWelle(ref rs_counter, entity, tra) #>
					<td class="zug klein"><!--Trapeztafel--><#= helper.TrapezHalt(tra, s) #></td>
					<#
					var ardp = tra.GetArrDep(s);
					var ar = ardp.Arrival.ToShortTimeString();
					var dp = ardp.Departure.ToShortTimeString();
					var zlm = ardp.Zuglaufmeldung;
					#>
					<td class="zug"><#= ar != "00:00" ? ar : "" #></td>
					<td class="zug"><#= dp != "00:00" ? dp : "" #></td>
					<td class="zug klein"><!--Kreuzung--><#= helper.Kreuzt(tra, s) #></td>
					<td class="zug klein"><!--überholt--><#= helper.Ueberholt(tra, s) #></td>
					<td class="zug klein last"><#= zlm ?? "" #><!--Zuglaufmeldung--></td>

					<# } else {
						BfplPoint p = (BfplPoint)entity; #>
					<td class="zug first"><#= p.Kilometre.ToString("0.0") #></td>
					<td class="zug"><#= p.GetAttribute("fpl-vmax", "") #></td>
					<td class="zug stat"><#= p.SName #></td>
					<#= GetWelle(ref rs_counter, entity, tra) #>
					<td class="zug klein"><!--Trapeztafel, bleibt leer--></td>
					<td class="zug"></td>
					<td class="zug"></td>
					<td class="zug klein"><!--Kreuzung, bleibt leer--></td>
					<td class="zug klein"><!--überholt, bleibt leer--></td>
					<td class="zug klein last"><!--Zuglaufmeldung--></td>
					<# } #>
				</tr>
				<# } #>
			</table>
			<# } #>
		</div>
	</body>
</html>